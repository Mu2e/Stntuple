# -*- mode: tcl -*-
BEGIN_PROLOG
#------------------------------------------------------------------------------
# all STNTUPLE modules inherit from the same base class, all of them are filters
# the base class defaults need to be included into every STNTUPLE module FCL 
# initialization template
# 
# they can be redefined 
# see example of redefining GEN_ID in Stntuple/test/read_reco_stntuple.fcl
# to be included by Stntuple/fcl/stntuple.fcl
#------------------------------------------------------------------------------
StntupleTModuleFclDefaults : {
    interactiveMode     : 0
    maxFileSize         : 2000   # in MBytes
#------------------------------------------------------------------------------
# if rootMacro is non-empty, it defines the name of a ROOT macro to be executed 
# in interpreted mode in the art event loop
# see https://github.com/Mu2e/Stntuple/blob/muse/doc/event_display.org#plugins
#------------------------------------------------------------------------------
    rootMacro           : ""
#------------------------------------------------------------------------------
# unlike everywhere else, TAnaDump sets mcTruth to 1 by default
#------------------------------------------------------------------------------
    TAnaDump : {
	printUtils      : { @table::TrkReco.PrintUtils 
	    mcTruth     : 1
	}
    }
    debugBits       : { 
	# bit0:1  
	# bit1:1 
	# bit51:1
    }
}
#------------------------------------------------------------------------------
# default configuration of StntupleMaker
#------------------------------------------------------------------------------
StntupleMakerTemplate : { module_type:StntupleMaker
    @table::StntupleTModuleFclDefaults                  # defaults of the base class
    module_name          : StntupleMaker
    processName          : undefined
#------------------------------------------------------------------------------
# define branches to be filled by default, in alphabetical order
#------------------------------------------------------------------------------    
    makeCalData          : 0
    makeClusters         : 1
    makeCrvPulses        : 0
    makeCrvClusters      : 1
    makeGenp             : 1
    makeHelices          : 0
    makePid              : 1
    makeSimp             : 1  # 0: dont write
    makeStepPointMC      : 1
    makeStrawHits        : 0
    makeStrawWaveforms   : 0
    makeTracks           : 1
    makeTrackStrawHits   : 0
    makeTrackSeeds       : 0
    makeTimeClusters     : 0
    makeTrigger          : 1
    
#    KalDiag                      : { @table::KalDiagDirect    }
    DoubletAmbigResolver         : { @table::TrkReco.DoubletAmbigResolver }

    caloCrystalHitsMaker         : "CaloHitMaker"
    caloClusterMaker             : "CaloClusterMaker"
#------------------------------------------------------------------------------
# default tags for CRV reco collections
#------------------------------------------------------------------------------
    crvRecoPulseCollTag          : "CrvRecoPulses"
    crvCoincidenceCollTag        : "CrvCoincidence"
    crvCoincidenceClusterCollTag : "CrvCoincidenceClusterFinder"
#------------------------------------------------------------------------------
# sometimes may need to store multiple track blocks, thus - vectors
# by default, always run MergePatRec, which, in case only one track reconstruction
# module is running upstream, simply copies its output
# 'spmc' stands for 'StepPointMC'
# STN_COMPRESS_MCS is ddefined in 'Stntuple/fcl/stntuple.fcl' and can be redefined 
# in the job config file
#------------------------------------------------------------------------------
    chCollTag            : "makePH"
    strawDigiCollTag     : "makeSD"
    sdwfCollTag          : "makeSD"
    shCollTag            : "makeSH"
    strawDigiMCCollTag   : @local::STN_COMPRESS_MCS              # was "makeSD"
#------------------------------------------------------------------------------
# TSimpBlock initialization parameters
# vdHitsCollTag is used by TStnTrackBlock and TSimpBlock, hits on virtual detectors 
# are stored in SpmcBlockVDet block, so all three have to be consistent
# for datasets with pileup, "TriggerResults::Mix" 
#------------------------------------------------------------------------------
    simpCollTag          : @local::STN_COMPRESS_MCS              # was "g4run" before
    primaryParticleTag   : @local::STN_COMPRESS_MCS              # this is new, to be passed to InitSimpBlock
    triggerResultsTag    : "TriggerResults"                      # assume TriggerResults produced at digi step
    nTriggerBits         : 250                                   # this is a kludge due to no trigger table stored
    vdHitsCollTag        : @local::STN_VDHITS_COLL_TAG           # was "g4run" before
    minSimpMomentum      : 40.0                                  # MeV , minSimpMomentum < 0: store all with straw hits
    simpMaxZ             : 1800.0                                # not used

    genpCollTag          : @local::STN_COMPRESS_MCS              # save signal-only: "generate" 
#------------------------------------------------------------------------------
# cant input "unknown" from FCL, so try to set default in C++ - doesn't work
# as might need to be able to redefine GENID consistently
#------------------------------------------------------------------------------
    genId                : @local::GEN_ID                        # default: in Stntuple/mod/StntupleMaker_module.cc
    pdgId                : @local::PDG_ID                        # defined in Stntuple/fcl/stntuple.fcl, by default, don't check PDG ID
#------------------------------------------------------------------------------
# time clusters
#------------------------------------------------------------------------------
    timeClusterBlockName : [ "TimeClusterBlock"   ]              # to be renamed, *FIXME*
    timeClusterCollTag   : [ "TimeClusterFinderDe"]              # 
    tcShCollTag          : [ "makeSH"             ]              # time clusters could be searched for using straw hits
    tcChCollTag          : [ "makePH"             ]              # only
#------------------------------------------------------------------------------
# ultimately all downstream helices will be in one block, upstream ones - in another 
# specify list of KalSeeds corresponding to Helices explicitly - it could be either 
# a list of "intermediate" KalSeeds in case of BTRK fits, 
# or a lit of "final" tracks in case of KinKal fits
#------------------------------------------------------------------------------
    helixBlockName       : [ "MHDeM"        ]
    helixCollTag         : [ "HelixBlock"   ]
    helixKsCollTag       : [ "KSFDeM"       ]                    # KalSeed collection corresponding to helices
#------------------------------------------------------------------------------
# intermediate track seed fits - going away
#------------------------------------------------------------------------------
    trackSeedBlockName   : [ "KSFBlock"     ]
    trackSeedCollTag     : [ "KSFDeM"       ]
#------------------------------------------------------------------------------
# default - negative particles... need to redo merging of opposite signs
#------------------------------------------------------------------------------
    trackBlockName       : [ "TrackBlock"   ]
    trackCollTag         : [ "KFFDeM"       ]
    trackFitType         : 1                         ## 1:BTRK(KFF) 2:KinKal(KK)

    trackTsBlockName     : [ "KSFBlock"     ]
    trackTsCollTag       : [ "KSFDeM"       ]        ## has to be defined for BTRK   fits
    trackHsBlockName     : [ "HelixBlock"   ]        ## has to be defined for KinKal fits

    tciCollTag           : [ "TrkExtrapol"  ]
    tcmCollTag           : [ "CaloMatching" ]
    trkQualCollTag       : [ "TrackQual"    ]
    pbiTag               : "PBISim"                   ## proton bunch intensity object
    pidBlockName         : [ "PidBlock"     ]
    pidCollTag           : [ "ParticleID"   ]    #   [ "AvikPID"      ]
    trackSHBlockName     : [ "TrackHitBlock"] 

    trkExtrapol          : TrkExtrapol
    trkCalMatch          : CaloMatching

    minTActive           : 0.       # ns
    minECrystal          : 1.0      # MeV
#------------------------------------------------------------------------------
# this is the default for Stage1 simulation
#------------------------------------------------------------------------------
    spmcBlockName        : [ "SpmcBlockVDet"                  , "SpmcBlock"             ]
    spmcCollTag          : [ @local::STN_VDHITS_COLL_TAG      , "muonBeamFilter:mubeam" ]
    statusG4Tag          : [ "g4run"                          , "g4run"                 ]
#------------------------------------------------------------------------------
# filtering
#------------------------------------------------------------------------------
    minNHelices          : 0
    cutHelixSeedCollTag  : "undefined"
}

#------------------------------------------------------------------------------
# when needed, mask DeltaFinder under 'FlagBkgHits' label
#------------------------------------------------------------------------------
MuHitDisplay: { module_type:MuHitDisplay                 # class name;
    @table::StntupleTModuleFclDefaults                   # defaults of the base class

    interactiveMode              : 1                                # 1:stop  after each event 2: stop at end-of-job
    
    crvRecoPulsesCollTag         : "CrvRecoPulses"
    showCRVOnly 		 : false
    showTracks                   : true
    
    genpCollTag                  : "generate"
    comboHitCollTag              : "FlagBkgHits"                     ## (was "makePH") flagged comboHits
    chfCollTag                   : "FlagBkgHits:ComboHits"           # combo hit flags
    helixSeedCollTag             : "MHFinderDe"                      # helices
    strawHitCollTag              : "makeSH"
    sdCollTag                    : "compressDigiMCs"                 # standard MC choice
    swCollTag                    : "compressDigiMCs"                 # standard MC choice
    sdmcCollTag                  : "compressDigiMCs"                 #  was "makeSD"
##    shfCollTag                   : "FlagBkgHits:StrawHits"           # straw hit flags
    spmcCollTag                  : "compressDigiMCs:virtualdetector" # was g4run
    simpCollTag                  : "compressDigiMCs"                 # was g4run

    caloHitCollTag               : "CaloHitMaker"
    caloClusterCollTag           : "CaloClusterMaker"

    phiClusterCollTag            : "PhiClusterFinder"
    timeClusterCollTag           : "CalTimePeakFinder"
    trackCollTag                 : "KFFDeMHDar"
    kffCollTag                   : "KSFDeMHDar"
    ksfCollTag                   : "KFFDeMHDar"

    trkExtrapol                  : "TrackCaloIntersection"
    trkCalMatch                  : "TrackCaloMatching"

    pidCollTag                   : "ParticleID"
    primaryParticleTag           : "compressDigiMCs"                 # this is new, to be passed to InitSimpBlock
    vdHitsCollTag                : "compressDigiMCs:virtualdetector" # this is new, to be passed to InitSimpBlock
    
    #      goodHitMask                 : ["EnergySelection","RadiusSelection","TimeSelection"]
    goodHitMask                  : ["EnergySelection", "RadiusSelection"]
    badHitMask                   : ["Background"] 
    
    minHits                      : 5
    minSimpMomentum              : 40. # MeV
    timeWindow                   : 100000.
#------------------------------------------------------------------------------
# kalDiag and Doublet Resolver
#------------------------------------------------------------------------------
#    KalDiag                 : { @table::KalDiagDirect    }
    DoubletAmbigResolver    : { @table::TrkReco.DoubletAmbigResolver }
#------------------------------------------------------------------------------
# configuration of the underlying visualization manager 
#------------------------------------------------------------------------------
    visManager: {
	defaultView        : "xy"     # view open by default
	displayStrawDigiMC : 1
	displayStrawHitsXY : 1
	debugLevel         : 0
	bField             : 1.0      # in Tesla
	tMin               : 0.
	tMax               : 2000.    # override for extracted position
    }
#------------------------------------------------------------------------------
# plugin configuration, plugin is a name of the script to be loaded
# it is assumed that if the name of the script is "/s/../b/a.C", a call to void "a()" 
# should be executed once per event
#------------------------------------------------------------------------------
    rootMacro              : ""
}
#------------------------------------------------------------------------------
# namespace
#------------------------------------------------------------------------------
Stntuple : {
    producers : {}  # empty table

    filters   : {
	EventFilter : { module_type:EventFilter
	    printFreq    : 1000000
	    eventList    : []          # [ run1, subrun1, event1, ...]
	}
    } 
#------------------------------------------------------------------------------
# STNTUPLE modules become analyzers - need to deal with the trigger intormation
#------------------------------------------------------------------------------
    analyzers : {
	InitStntuple : { module_type:InitStntuple
	    @table::StntupleTModuleFclDefaults                  # defaults of the base class
	    module_name       : InitStntuple
	    histFileName      : "default.stn"
	    splitLevel        : 99
	}

	FillStntuple : { module_type:FillStntuple
	    @table::StntupleTModuleFclDefaults                  # defaults of the base class
	    module_name       : FillStntuple
	}

	StntupleEventDump : { module_type:StntupleEventDump 
	    @table::StntupleTModuleFclDefaults                  # defaults of the base class
	    module_name       : StntupleEventDump
	}
#------------------------------------------------------------------------------
# downstream electrons - explicitly - the same as default
#------------------------------------------------------------------------------
	StntupleMaker     : { @table::StntupleMakerTemplate }

	StntupleMakerCpr  : { @table::StntupleMakerTemplate 
	    trackBlockName            : [ "TrackBlock"               ] 
	    trackSHBlockName          : [ "TrackHitBlock"            ] 
	    trackCollTag              : [ "MergePatRecCpr"           ]
	    tciCollTag                : [ "TrackCaloIntersectionCpr" ]
	    tcmCollTag                : [ "TrackCaloMatchingCpr"     ]

	    makePid                   : 0
	    pidBlockName              : [ "PidBlock"                 ] 
	    pidCollTag                : [ "AvikPIDNewCpr"            ]

	    makeTrackSeeds            : 1
	}

	StntupleMakerDem  : { @table::StntupleMakerTemplate 
	    makePid                 : 1
	    trackBlockName          : [ "TrackBlockDem"            ] 
	    trackSHBlockName        : [ "TrackHitBlockDem"         ] 
	    trackCollTag            : [ "MergePatRecDem"           ]
	    tciCollTag              : [ "TrackCaloIntersectionDem" ]
	    tcmCollTag              : [ "TrackCaloMatchingDem"     ]
	    pidBlockName            : [ "PidBlockDem"              ] 
	    pidCollTag              : [ "AvikPIDNewDem"            ]
	}

	StntupleMakerDep  : { @table::StntupleMakerTemplate 
	    makePid                 : 1
	    trackBlockName          : [ "TrackBlockDep"            ] 
	    trackSHBlockName        : [ "TrackHitBlockDep"         ] 
	    trackCollTag            : [ "MergePatRecDep"           ]
	    tciCollTag              : [ "TrackCaloIntersectionDep" ]
	    tcmCollTag              : [ "TrackCaloMatchingDep"     ]
	    pidBlockName            : [ "PidBlockDep"              ] 
	    pidCollTag              : [ "AvikPIDNewDep"            ]
	}
#------------------------------------------------------------------------------
# downstream proton reco
#------------------------------------------------------------------------------
	StntupleMakerDpp  : { @table::StntupleMakerTemplate 
	    makePid                 : 0
	    trackBlockName          : [ "TrackBlockDpp"            ]
	    trackSHBlockName        : [ "TrackHitBlockDpp"         ]
	    trackCollTag            : [ "KFFDpP"                   ]
	    tciCollTag              : [ "TrackCaloIntersectionDpp" ]
	    tcmCollTag              : [ "TrackCaloMatchingDpp"     ]
	    pidBlockName            : [ "PidBlockDpp"              ]
	    pidCollTag              : [ "AvikPIDNewDpp"            ]
	}
#------------------------------------------------------------------------------
# downstream mu- reco
#------------------------------------------------------------------------------
	StntupleMakerDmm  : { @table::StntupleMakerTemplate 
	    makePid                 : 1
	    trackBlockName          : [ "TrackBlockDmm"            ] 
	    trackSHBlockName        : [ "TrackHitBlockDmm"         ] 
	    trackCollTag            : [ "MergePatRecDmm"           ]
	    tciCollTag              : [ "TrackCaloIntersectionDmm" ]
	    tcmCollTag              : [ "TrackCaloMatchingDmm"     ]
	    pidBlockName            : [ "PidBlockDmm"              ] 
	    pidCollTag              : [ "AvikPIDNewDmm"            ]
	}
#------------------------------------------------------------------------------
# upstream mu+ reco - explicitly 
#------------------------------------------------------------------------------
	StntupleMakerUmp  : { @table::StntupleMakerTemplate 
	    makePid                 : 0
	    trackBlockName          : [ "TrackBlockUmp"            ] 
	    trackSHBlockName        : [ "TrackHitBlockUmp"         ] 
	    trackCollTag            : [ "MergePatRecUmp"           ]
	    tciCollTag              : [ "TrackCaloIntersectionUmp" ]
	    tcmCollTag              : [ "TrackCaloMatchingUmp"     ]
	    pidCollTag              : [ "AvikPIDNewUmp"            ]
	}
#------------------------------------------------------------------------------
# explicitly store 2 versions of track reco - downstream e- and mu- reco
#------------------------------------------------------------------------------
	StntupleMakerDemDmm  : { @table::StntupleMakerTemplate 
	    makePid                 : 1
	    trackBlockName          : [ "TrackBlockDem"            , "TrackBlockDmm"           ] 
	    trackSHBlockName        : [ "TrackHitBlockDem"         , "TrackHitBlockDmm"        ] 
	    trackCollTag            : [ "MergePatRecDem"           , "MergePatRecDmm"          ]
	    tciCollTag              : [ "TrackCaloIntersectionDem" , "TrackCaloIntersectionDmm"]
	    tcmCollTag              : [ "TrackCaloMatchingDem"     , "TrackCaloMatchingDmm"    ]
	    pidBlockName            : [ "PidBlockDem"              , "PidBlockDmm"             ] 
	    pidCollTag              : [ "AvikPIDNewDem"            , "AvikPIDNewDmm"           ]
	}
#------------------------------------------------------------------------------
# explicitly store 2 versions of track reco - downstream e- and e+ reco
#------------------------------------------------------------------------------
	StntupleMakerDemDep  : { @table::StntupleMakerTemplate 
	    makePid                 : 1
	    trackBlockName          : [ "TrackBlockDem"            , "TrackBlockDep"           ] 
	    trackSHBlockName        : [ "TrackHitBlockDem"         , "TrackHitBlockDep"        ] 
	    trackCollTag            : [ "MergePatRecDem"           , "MergePatRecDep"          ]
	    tciCollTag              : [ "TrackCaloIntersectionDem" , "TrackCaloIntersectionDep"]
	    tcmCollTag              : [ "TrackCaloMatchingDem"     , "TrackCaloMatchingDep"    ]
	    pidBlockName            : [ "PidBlockDem"              , "PidBlockDep"             ] 
	    pidCollTag              : [ "AvikPIDNewDem"            , "AvikPIDNewDep"           ]
	}
#------------------------------------------------------------------------------
# generate upstream mu+ 
#------------------------------------------------------------------------------
	StntupleMakerDemUmp  : { @table::StntupleMakerTemplate 
	    makePid                 : 0
	    trackBlockName          : [ "TrackBlockDem"            , "TrackBlockUmp"           ] 
	    trackSHBlockName        : [ "TrackHitBlockDem"         , "TrackHitBlockUmp"        ] 
	    trackCollTag            : [ "MergePatRecDem"           , "MergePatRecUmp"          ]
	    tciCollTag              : [ "TrackCaloIntersectionDem" , "TrackCaloIntersectionUmp"]
	    tcmCollTag              : [ "TrackCaloMatchingDem"     , "TrackCaloMatchingUmp"    ]
	    pidCollTag              : [ "AvikPIDNewDem"            , "AvikPIDNewUmp"           ]
	}
#------------------------------------------------------------------------------
# generate upstream mu-  
#------------------------------------------------------------------------------
	StntupleMakerDemUmm  : { @table::StntupleMakerTemplate 
	    makePid                 : 1
	    makeTrackStrawHits      : 1
	    trackBlockName          : [ "TrackBlockDem"            , "TrackBlockUmm"           ] 
	    trackSHBlockName        : [ "TrackHitBlockDem"         , "TrackHitBlockUmm"        ] 
	    trackCollTag            : [ "MergePatRecDem"           , "MergePatRecUmm"          ]
	    tciCollTag              : [ "TrackCaloIntersectionDem" , "TrackCaloIntersectionUmm"]
	    tcmCollTag              : [ "TrackCaloMatchingDem"     , "TrackCaloMatchingUmm"    ]
	    pidCollTag              : [ "AvikPIDNewDem"            , "AvikPIDNewUmm"           ]
	}
#------------------------------------------------------------------------------
# track reconstruction studies: 
# make 3 track blocks, for the moment need to specify all other labels
#------------------------------------------------------------------------------
	StntupleMakerTcm : { @table::StntupleMakerTemplate 
	    makePid                    : 0
	    makeTrackSeeds             : 1
	    makeTimeClusters           : 1
	    makeHelices                : 1
	    timeClusterBlockName       : [ "TprTimeClusterBlock"     , "CprTimeClusterBlock"     ]
	    timeClusterCollTag         : [ "TimeClusterFinderDe"     , "CalTimePeakFinder"       ]
	    helixBlockName             : [ "TprHelixBlock"           , "CprHelixBlock"           ]
	    helixCollTag               : [ "HelixFindere:Positive"   , "CalHelixFinder:Positive" ]
	    trackSeedBlockName         : [ "TprTrackSeedBlock"       , "CprTrackSeedBlock"       ]
	    trackSeedModuleLabel       : [ "KSFDeM"                  , "CalSeedFit"              ]
	    trackBlockName             : [ "TprTrackBlock"           , "CprTrackBlock"           , "TrackBlock"             ]
	    trackCollTag               : [ "MergePatRecTpr"          , "MergePatRecCpr"          , "MergePatRec"            ]
	    tciCollTag                 : [ "TrackCaloIntersectionTpr", "TrackCaloIntersectionCpr", "TrackCaloIntersection"  ]
	    tcmCollTag                 : [ "TrackCaloMatchingTpr"    , "TrackCaloMatchingCpr"    , "TrackCaloMatching"      ]
	    trackSHBlockName           : [ "TrackHitBlockTpr"        , "TrackHitBlockCpr"        , "TrackHitBlock"          ] 
	    pidBlockName               : [ ""                        , ""                        , "PidBlock"               ] 
	    pidCollTag                 : [                        "" ,                         "", "AvikPIDNew"             ]
	}
#------------------------------------------------------------------------------
# track reconstruction studies: 
# make 3 track blocks, for the moment need to specify all other labels
#------------------------------------------------------------------------------
	StntupleMakerTcmDem : { @table::StntupleMakerTemplate 
	    makePid                    : 0
	    makeTrackSeeds             : 1
	    makeTimeClusters           : 1
	    makeHelices                : 1
	    timeClusterBlockName       : [ "TimeClusterBlockTpr"        , "TimeClusterBlockCpr"        ]
	    timeClusterCollTag         : [ "TimeClusterFinderDe"        , "CalTimePeakFinder"          ]
	    helixBlockName             : [ "HelixBlockTpr"              , "HelixBlockCpr"              ]
	    helixCollTag               : [ "HelixFinder:Positive"       , "CalHelixFinderDe:Positive"  ]

	    trackSeedBlockName         : [ "TrackSeedBlockTpr"          , "TrackSeedBlockCpr"          , "TrackSeedBlock"           ]
	    trackSeedCollTag           : [ "KSFDeM"                     , "CalSeedFitDem"              , "MergePatRecDem"           ]

	    trackBlockName             : [ "TrackBlockTpr"              , "TrackBlockCpr"              , "TrackBlock"               ]
	    trackCollTag               : [ "MergePatRecTprDem"          , "MergePatRecCprDem"          , "MergePatRecDem"           ]
	    trackTsBlockName           : [ "TrackSeedBlockTpr"          , "TrackSeedBlockCpr"          , "TrackSeedBlock"           ]
	    trackTsCollTag             : [ "KSFDeM"                     , "CalSeedFitDem"              , "MergePatRecDem"           ]

	    tciCollTag                 : [ "TrackCaloIntersectionTprDem", "TrackCaloIntersectionCprDem", "TrackCaloIntersectionDem" ]
	    tcmCollTag                 : [ "TrackCaloMatchingTprDem"    , "TrackCaloMatchingCprDem"    , "TrackCaloMatchingDem"     ]
	    trackSHBlockName           : [ "TrackHitBlockTpr"           , "TrackHitBlockCpr"           , "TrackHitBlock"            ] 
	    pidBlockName               : [ ""                           , ""                           , "PidBlock"                 ] 
	    pidCollTag                 : [                        ""    ,                         ""   , "AvikPIDNew"               ]
	}
#------------------------------------------------------------------------------
# track reconstruction studies: 
# make 3 track blocks, for the moment need to specify all other labels
#------------------------------------------------------------------------------
	StntupleMakerTcmDep : { @table::StntupleMakerTemplate 
	    makePid                    : 0
	    makeTrackSeeds             : 1
	    makeTimeClusters           : 1
	    makeHelices                : 1
	    timeClusterBlockName       : [ "TimeClusterBlockTpr"        , "TimeClusterBlockCpr"        ]
	    timeClusterCollTag         : [ "TimeClusterFinderDe"        , "CalTimePeakFinder"          ]

	    helixBlockName             : [ "HelixBlockTpr"              , "HelixBlockCpr"              , "HelixBlock"               ]
	    helixCollTag               : [ "HelixFinder:Negative"       , "CalHelixFinderDe:Negative"  , ""                         ]

	    trackSeedBlockName         : [ "TrackSeedBlockTpr"          , "TrackSeedBlockCpr"          , "TrackSeedBlock"           ]
	    trackSeedCollTag           : [ "KSFDeP"                     , "CalSeedFitDep"              , "MergePatRecDep"           ]

	    trackBlockName             : [ "TrackBlockTpr"              , "TrackBlockCpr"              , "TrackBlock"               ]
	    trackCollTag               : [ "MergePatRecTprDep"          , "MergePatRecCprDep"          , "MergePatRecDep"           ]
	    trackTsBlockName           : [ "TrackSeedBlockTpr"          , "TrackSeedBlockCpr"          , "TrackSeedBlock"           ]
	    trackTsCollTag             : [ "KSFDeP"                     , "CalSeedFitDep"              , "MergePatRecDep"           ]

	    tciCollTag                 : [ "TrackCaloIntersectionTprDep", "TrackCaloIntersectionCprDep", "TrackCaloIntersectionDep" ]
	    tcmCollTag                 : [ "TrackCaloMatchingTprDep"    , "TrackCaloMatchingCprDep"    , "TrackCaloMatchingDep"     ]
	    trackSHBlockName           : [ "TrackHitBlockTpr"           , "TrackHitBlockCpr"           , "TrackHitBlock"            ] 
	    pidBlockName               : [ ""                           , ""                           , "PidBlock"                 ] 
	    pidCollTag                 : [                        ""    ,                         ""   , "AvikPIDNew"               ]
	}
#------------------------------------------------------------------------------
# analysis prototype II: start using the merged helix list, make 2 track blocks, 
# combine electrons and positrons
# 3 helix blocks: merged, HelixFindex, CalHelixFinder
# 1 track seed block : merged sequence
# 2 track fit blocks : Panel AR and Doublet AR
#------------------------------------------------------------------------------
	StntupleMakerDe : { @table::StntupleMakerTemplate 
	    makePid                    : 0
	    makeTrackSeeds             : 1
	    makeTimeClusters           : 1
	    makeHelices                : 1
	    makeStepPointMC            : 1

	    timeClusterBlockName       : [ ""                    , "TimeClusterBlockTpr", "TimeClusterBlockCpr" ]
  	    timeClusterCollTag         : [ ""                    , "TimeClusterFinderDe", "CalTimePeakFinder"   ]

	    helixBlockName             : [ "HelixBlock"          , "HelixBlockTpr"      , "HelixBlockCpr"       ]
	    helixCollTag               : [ "MHFinderDe"          , "MHFinderTprDe"      , "MHFinderCprDe"       ]

	    trackSeedBlockName         : [ "TrackSeedBlock"      ]
	    trackSeedCollTag           : [ "KSFDeMH"             ]

	    trackBlockName             : [ "TrackBlockPar"       , "TrackBlockDar"        ]
	    trackCollTag               : [ "KFFDeMHPar"          , "KFFDeMHDar"           ]
	    trackTsBlockName           : [ "TrackSeedBlock"      , "TrackSeedBlock"       ]
	    trackTsCollTag             : [ "KSFDeMH"             , "KSFDeMH"              ]

	    tciCollTag                 : [ "TciDeMHPar"          , "TciDeMHDar"           ]
	    tcmCollTag                 : [ "TcmDeMHPar"          , "TcmDeMHDar"           ]
	    trkQualCollTag             : [ "TrkQualDeMHPar"      , "TrkQualDeMHDar"       ]
	    trackSHBlockName           : [ "TrackHitBlockPar"    , "TrackHitBlockDar"     ]
	    pidBlockName               : [ ""                    , "PidBlock"             ]
	    pidCollTag                 : [ ""                    , "AvikPIDNew"           ]

	    spmcBlockName              : [ "SpmcBlockVDet"             ]
	    spmcCollTag                : [ @local::STN_VDHITS_COLL_TAG ]
	    statusG4Tag                : [ "g4run"                     ]
	}

	StntupleMakerDmu : { @table::StntupleMakerTemplate 
	    makePid                    : 0
	    makeTrackSeeds             : 1
	    makeTimeClusters           : 1
	    makeHelices                : 1
	    timeClusterBlockName       : [ ""                     , "TimeClusterBlockTpr" , "TimeClusterBlockCpr"  ]
	    timeClusterCollTag         : [ ""                     , "TimeClusterFinderMu" , "CalTimePeakFinderMu" ]
	    helixBlockName             : [ "HelixBlock"           , "HelixBlockTpr"       , "HelixBlockCpr"       ]
	    helixCollTag               : [ "MHFinderDmu"          , "MHFinderTprDmu"      , "MHFinderCprDmu"      ]

	    trackSeedBlockName         : [ "TrackSeedBlock"      ]
	    trackSeedCollTag           : [ "KSFDmuMH"            ]

	    trackBlockName             : [ "TrackBlockPar"       , "TrackBlockDar"      ]
	    trackCollTag               : [ "KFFDmuMHPar"         , "KFFDmuMHDar"        ]
	    trackTsBlockName           : [ "TrackSeedBlock"      , "TrackSeedBlock"     ]
	    trackTsCollTag             : [ "KSFDmuMH"            , "KSFDmuMH"           ]

	    tciCollTag                 : [ "TciDmuMHPar"         , "TciDmuMHDar"        ]
	    tcmCollTag                 : [ "TcmDmuMHPar"         , "TcmDmuMHDar"        ]
	    trkQualCollTag             : [ "TrkQualDmuMHPar"     , "TrkQualDmuMHDar"    ]

	    trackSHBlockName           : [ "TrackHitBlockPar"    , "TrackHitBlockDar"   ]
	    pidBlockName               : [ ""                    , "PidBlock"           ]
	    pidCollTag                 : [       ""              , "AvikPIDNew"         ]

	    spmcBlockName              : [ "SpmcBlockVDet"             ]
	    spmcCollTag                : [ @local::STN_VDHITS_COLL_TAG ]
	    statusG4Tag                : [ "g4run"                     ]
	}

	StntupleMakerDeDmu : { @table::StntupleMakerTemplate 
	    makePid                    : 0
	    makeTrackSeeds             : 1
	    makeTimeClusters           : 1
	    makeHelices                : 1
	    makeStepPointMC            : 1

	    timeClusterBlockName       : [ "TimeClusterBlockDe"  , "TimeClusterBlockDmu"]
  	    timeClusterCollTag         : [ "MHFinderDe"          , "MHFinderDmu"        ]
# there should be one-to-one mapping between track seed and helix blocks
	    helixBlockName             : [ "HelixBlock"          , "HelixBlockDmu"      ]
	    helixCollTag               : [ "MHFinderDe"          , "MHFinderDmu"        ]

	    trackSeedBlockName         : [ "TrackSeedBlock"      , "TrackSeedBlockDmu"  ]
	    trackSeedCollTag           : [ "KSFDeMH"             , "KSFDmuMH"           ]

	    trackBlockName             : [ "TrackBlockPar"       , "TrackBlockDar"      , "TrackBlockParDmu"     , "TrackBlockDarDmu"     ]
	    trackCollTag               : [ "KFFDeMHPar"          , "KFFDeMHDar"         , "KFFDmuMHPar"          , "KFFDmuMHDar"          ]
	    trackTsBlockName           : [ "TrackSeedBlock"      , "TrackSeedBlock"     , "TrackSeedBlockDmu"    , "TrackSeedBlockDmu"    ]
	    trackTsCollTag             : [ "KSFDeMH"             , "KSFDeMH"            , "KSFDmuMH"             , "KSFDmuMH"             ]

	    tciCollTag                 : [ "TciDeMHPar"          , "TciDeMHDar"         , "TciDmuMHPar"          , "TciDmuMHDar"          ]
	    tcmCollTag                 : [ "TcmDeMHPar"          , "TcmDeMHDar"         , "TcmDmuMHPar"          , "TcmDmuMHDar"          ]
	    trkQualCollTag             : [ "TrkQualDeMHPar"      , "TrkQualDeMHDar"     , "TrkQualDmuMHPar"      , "TrkQualDmuMHDar"      ]
	    trackSHBlockName           : [ "TrackHitBlockPar"    , "TrackHitBlockDar"   , "TrackHitBlockParDmu"  , "TrackHitBlockDarDmu"  ]
	    pidBlockName               : [ ""                    , "PidBlock"           , ""                     , "PidBlockDmu"          ]
	    pidCollTag                 : [ ""                    , "AvikPIDNew"         , ""                     , "AvikPIDNewDmu"        ]

	    spmcBlockName              : [ "SpmcBlockVDet"             ]
	    spmcCollTag                : [ @local::STN_VDHITS_COLL_TAG ]
	    statusG4Tag                : [ "g4run"                     ]
	}

	StntupleMakerDeDmuDar : { @table::StntupleMakerTemplate 
	    makePid                    : 0
	    makeTrackSeeds             : 1
	    makeTimeClusters           : 1
	    makeHelices                : 1
	    makeStepPointMC            : 1

	    timeClusterBlockName       : [ "TimeClusterBlockDe"  , "TimeClusterBlockDmu" ]
  	    timeClusterCollTag         : [ "MHFinderDe"          , "MHFinderDmu"         ]
	    helixBlockName             : [ "HelixBlockDe"        , "HelixBlockDmu"       ]
	    helixCollTag               : [ "MHFinderDe"          , "MHFinderDmu"         ]

	    trackSeedBlockName         : [ "TrackSeedBlockDe"    , "TrackSeedBlockDmu"   ]
	    trackSeedCollTag           : [ "KSFDeMH"             , "KSFDmuMH"            ]

	    trackBlockName             : [ "TrackBlockDarDe"     , "TrackBlockDarDmu"    ]
	    trackCollTag               : [ "KFFDeMHDar"          , "KFFDmuMHDar"         ]
	    trackTsBlockName           : [ "TrackSeedBlockDe"    , "TrackSeedBlockDmu"   ]
	    trackTsCollTag             : [ "KSFDeMH"             , "KSFDmuMH"            ]

	    tciCollTag                 : [ "TciDeMHDar"          , "TciDmuMHDar"         ]
	    tcmCollTag                 : [ "TcmDeMHDar"          , "TcmDmuMHDar"         ]
	    trkQualCollTag             : [ "TrkQualDeMHDar"      , "TrkQualDmuMHDar"     ]
	    trackSHBlockName           : [ "TrackHitBlockDarDe"  , "TrackHitBlockDarDmu" ]
	    pidBlockName               : [ "PidBlockDe"          , "PidBlockDmu"         ]
	    pidCollTag                 : [ "AvikPIDNew"          , "AvikPIDNewDmu"       ]

	    spmcBlockName              : [ "SpmcBlockVDet"             ]
	    spmcCollTag                : [ @local::STN_VDHITS_COLL_TAG ]
	    statusG4Tag                : [ "g4run"                     ]
	}
#------------------------------------------------------------------------------
# explicit muon reco is not very useful, run De and Ue instead, use only DAR fits
# for cosmics, add all TimeCluster collections
#------------------------------------------------------------------------------
	StntupleMakerDeUeDar : { @table::StntupleMakerTemplate 
	    makePid                    : 0
	    makeTrackSeeds             : 1
	    makeTimeClusters           : 1
	    makeHelices                : 1
	    makeStepPointMC            : 1
	    makeTrigger                : 0  # so far, can't use

	    timeClusterBlockName       : [ "TimeClusterBlockDe", "TimeClusterBlockUe", "TCFinderBlockDe"    , "TCFinderBlockUe"    , "CTPFinderBlock"    ]
  	    timeClusterCollTag         : [ "MHFinderDe"        , "MHFinderUe"        , "TimeClusterFinderDe", "TimeClusterFinderUe", "CalTimePeakFinder" ]
	    helixBlockName             : [ "HelixBlockDe"      , "HelixBlockUe"        ]
	    helixCollTag               : [ "MHFinderDe"        , "MHFinderUe"          ]

	    trackSeedBlockName         : [ "TrackSeedBlockDe"  , "TrackSeedBlockUe"    ]
	    trackSeedCollTag           : [ "KSFDeMH"           , "KSFUeMH"             ]

	    trackBlockName             : [ "TrackBlockDarDe"   , "TrackBlockDarUe"     ]
	    trackCollTag               : [ "KFFDeMHDar"        , "KFFUeMHDar"          ]
	    trackTsBlockName           : [ "TrackSeedBlockDe"  , "TrackSeedBlockUe"    ]
	    trackTsCollTag             : [ "KSFDeMH"           , "KSFUeMH"             ]

	    tciCollTag                 : [ "TciDeMHDar"        , "TciUeMHDar"          ]
	    tcmCollTag                 : [ "TcmDeMHDar"        , "TcmUeMHDar"          ]
	    trkQualCollTag             : [ "TrkQualDeMHDar"    , "TrkQualUeMHDar"      ]
	    trackSHBlockName           : [ "TrackHitBlockDarDe", "TrackHitBlockDarUe"  ]
	    pidBlockName               : [ "PidBlockDe"        , "PidBlockUe"          ] # just need for code not to crash *FIXME*
	    pidCollTag                 : [ "AvikPIDNew"        , "AvikPIDNewUe"        ] # just need for code not to crash *FIXME*

	    spmcBlockName              : [ "SpmcBlockVDet"             ]
	    spmcCollTag                : [ @local::STN_VDHITS_COLL_TAG ]
	    statusG4Tag                : [ "g4run"                     ]
	}
#------------------------------------------------------------------------------
# trigger studies
#------------------------------------------------------------------------------
	StntupleMakerTcmTrig : { @table::StntupleMakerTemplate 
	    makePid                    : 0
	    makeTrackSeeds             : 1
	    makeTimeClusters           : 1
	    makeHelices                : 1
	    timeClusterBlockName       : [ "TimeClusterBlockDepTpr"     , "TimeClusterBlockDepCpr"     , "TimeClusterBlockDemTpr"     , "TimeClusterBlockDemCpr"     ]
	    timeClusterCollTag         : [ "TimeClusterFinderDe"        , "CalTimePeakFinder"          , "TimeClusterFinderDe"        , "CalTimePeakFinder"          ]
	    helixBlockName             : [ "HelixBlockDepTpr"           , "HelixBlockDepCpr"           , "HelixBlockDemTpr"           , "HelixBlockDemCpr"           ]
	    helixCollTag               : [ "HelixFindere:Negative"      , "CalHelixFinderDe:Negative"  , "HelixFindere:Positive"      , "CalHelixFinderDe:Positive"  ]
	    trackSeedBlockName         : [ "TrackSeedBlockDepTpr"       , "TrackSeedBlockDepCpr"       , "TrackSeedBlockDemTpr"       , "TrackSeedBlockDemCpr"       ]
	    trackSeedCollTag           : [ "KSFDeP"                     , "CalSeedFitDep"              , "KSFDeM"                     , "CalSeedFitDem"              ]
	    trackBlockName             : [ "TrackBlockDepTpr"           , "TrackBlockDepCpr"           , "TrackBlockDemTpr"           , "TrackBlockDemCpr"           ]
	    trackCollTag               : [ "MergePatRecTprDep"          , "MergePatRecCprDep"          , "MergePatRecTprDem"          , "MergePatRecCprDem"          ]
	    trackTsBlockName           : [ "TrackSeedBlockDepTpr"       , "TrackSeedBlockDepCpr"       , "TrackSeedBlockDemTpr"       , "TrackSeedBlockDemCpr"       ]
	    trackTsCollTag             : [ "KSFDeP"                     , "CalSeedFitDep"              , "KSFDeM"                     , "CalSeedFitDem"              ]
	    tciCollTag                 : [ "TrackCaloIntersectionTprDep", "TrackCaloIntersectionCprDep", "TrackCaloIntersectionTprDem", "TrackCaloIntersectionCprDem"]
	    tcmCollTag                 : [ "TrackCaloMatchingTprDep"    , "TrackCaloMatchingCprDep"    , "TrackCaloMatchingTprDem"    , "TrackCaloMatchingCprDem"    ]
	    trackSHBlockName           : [ "TrackHitBlockDepTpr"        , "TrackHitBlockDepCpr"        , "TrackHitBlockDemTpr"        , "TrackHitBlockDemCpr"        ]
	    trkQualCollTag             : [ "TrkQualTprDeP"              , "TrkQualCprDeP"              , "TrkQualTprDeM"              , "TrkQualCprDeM       "       ] 
	    pidBlockName               : [ ""                           , ""                           , ""                           , ""                           ] 
	    pidCollTag                 : [                        ""    ,                         ""   ,                        ""    ,                         ""   ]
	}
#------------------------------------------------------------------------------
# trigger studies - new
# two merged helix collections: 
#------------------------------------------------------------------------------
	StntupleMakerTrig : { @table::StntupleMakerTemplate 
	    makePid                : 0
	    makeTimeClusters       : 1
	    makeHelices            : 1
	    makeTrackSeeds         : 1
	    makeTracks             : 0
	    timeClusterBlockName       : [ "TimeClusterBlockDepTpr"     , "TimeClusterBlockDepCpr"     , "TimeClusterBlockDemTpr"     , "TimeClusterBlockDemCpr"     ]
	    timeClusterCollTag         : [ "TTtimeClusterFinder"        , "TTCalTimePeakFinder"        , "TTtimeClusterFinder"        , "TTCalTimePeakFinder"        ]
	    helixBlockName             : [ "HelixBlockDepTpr"           , "HelixBlockDepCpr"           , "HelixBlockDemTpr"           , "HelixBlockDemCpr"           ]
	    helixCollTag               : [ "TThelixFinder:Negative"     , "TTCalHelixFinderDe:Negative", "TThelixFinder:Positive"     , "TTCalHelixFinderDe:Positive"]
	    trackSeedBlockName         : [ "TrackSeedBlockDepTpr"       , "TrackSeedBlockDepCpr"       , "TrackSeedBlockDemTpr"       , "TrackSeedBlockDemCpr"       ]
	    trackSeedCollTag           : [ "KSFDeP"                     , "TTCalSeedFitDep"            , "KSFDeM"                     , "TTCalSeedFitDem"            ]
	    trackBlockName             : []
	    trackCollTag               : []
	    tciCollTag                 : []
	    tcmCollTag                 : []
	    trackSHBlockName           : []
	    pidBlockName               : []
	    pidCollTag                 : []
        }
#------------------------------------------------------------------------------
# make 4 track blocks: train PID
#------------------------------------------------------------------------------
	StntupleMaker4 : { @table::StntupleMakerTemplate 
	    trackBlockName         : [ "TrackBlockDem"           , "TrackBlockDmm"           , "TrackBlockUep"           , "TrackBlockUmp"            ]
	    trackSHBlockName       : [ "TrackHitBlockDem"        , "TrackHitBlockDmm"        , "TrackHitBlockUep"        , "TrackHitBlockUmp"         ]
	    trackCollTag           : [ "MergePatRecDem"          , "MergePatRecDmm"          , "MergePatRecUep"          , "MergePatRecUmp"           ]
	    tciCollTag             : [ "TrackCaloIntersectionDem", "TrackCaloIntersectionDmm", "TrackCaloIntersectionUep", "TrackCaloIntersectionUmp" ]
	    tcmCollTag             : [ "TrackCaloMatchingDem"    , "TrackCaloMatchingDmm"    , "TrackCaloMatchingUep"    , "TrackCaloMatchingUmp"     ]
	    pidCollTag             : [ ""                        ,  ""                       , ""                        , ""                         ]

	    makePid                : 0
	}
#------------------------------------------------------------------------------
# 
#------------------------------------------------------------------------------
        StntupleRecoAna : { module_type : StntupleRecoAna
            @table::StntupleTModuleFclDefaults                  # defaults of the base class
            sschCollTag : "makeSH"
            chCollTag   : "makeSH"
            tcCollTag   : "TZClusterFinder"
            sdmcCollTag : "CompressDigiMCs"
            debugLevel  : 0
        }
#------------------------------------------------------------------------------
# 
#------------------------------------------------------------------------------
	MuHitDisplay    : { @table::MuHitDisplay }
    }
}
#------------------------------------------------------------------------------
# sequences, all of them go to end_path
#------------------------------------------------------------------------------
Stntuple.stnmaker         : [ InitStntuple, StntupleMaker   ,                   FillStntuple ]
# Stntuple.stnmaker_cpr     : [ InitStntuple, StntupleMakerCpr,                   FillStntuple ]
# Stntuple.stnmaker_dmm     : [ InitStntuple, StntupleMakerDmm,                   FillStntuple ]
# Stntuple.stnmaker_ump     : [ InitStntuple, StntupleMakerUmp,                   FillStntuple ]
# Stntuple.stnmaker_dpp     : [ InitStntuple, StntupleMakerDpp,                   FillStntuple ]
# Stntuple.stnmaker_dem_dep : [ InitStntuple, StntupleMakerDemDep,                FillStntuple ]
# Stntuple.stnmaker_dem_dmm : [ InitStntuple, StntupleMakerDem, StntupleMakerDmm, FillStntuple ]
# Stntuple.stnmaker_dem_umm : [ InitStntuple, StntupleMakerDem, StntupleMakerUmm, FillStntuple ]
# Stntuple.stnmaker_dem_ump : [ InitStntuple, StntupleMakerDem, StntupleMakerUmp, FillStntuple ]
# Stntuple.stnmaker_tcm     : [ InitStntuple, StntupleMakerTcm,                   FillStntuple ]
# Stntuple.stnmaker_tcm_dem : [ InitStntuple, StntupleMakerTcmDem,                FillStntuple ]
# Stntuple.stnmaker_tcm_dep : [ InitStntuple, StntupleMakerTcmDep,                FillStntuple ]
Stntuple.stnmaker_trig    : [ InitStntuple, StntupleMakerTrig,                  FillStntuple ]
#------------------------------------------------------------------------------
# new sequences
#------------------------------------------------------------------------------
# Stntuple.stnmaker_De      : [ InitStntuple, StntupleMakerDe  ,                  FillStntuple ]
# Stntuple.stnmaker_Dmu     : [ InitStntuple, StntupleMakerDmu ,                  FillStntuple ]
# Stntuple.stnmaker_De_Dmu  : [ InitStntuple, StntupleMakerDeDmu,                 FillStntuple ]
# 
# Stntuple.stnmaker_De_Dmu_dar : [ InitStntuple, StntupleMakerDeDmuDar,           FillStntuple ]
# Stntuple.stnmaker_De_Ue_dar  : [ InitStntuple, StntupleMakerDeUeDar,            FillStntuple ]

END_PROLOG
